



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Open Source Docs and Community Standards">
      
      
        <link rel="canonical" href="https://homeaway.github.io/datapull/install_on_aws/">
      
      
        <meta name="author" content="Data Tools">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.0">
    
    
      
        <title>Installing DataPull on AWS Fargate and S3 - DataPull Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deploying-datapull-on-aws-fargate-and-aws-emr" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://homeaway.github.io/datapull" title="DataPull Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DataPull Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Installing DataPull on AWS Fargate and S3
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/homeaway/datapull/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    homeaway/datapull
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://homeaway.github.io/datapull" title="DataPull Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    DataPull Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/homeaway/datapull/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    homeaway/datapull
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installing DataPull on AWS Fargate and S3
      </label>
    
    <a href="./" title="Installing DataPull on AWS Fargate and S3" class="md-nav__link md-nav__link--active">
      Installing DataPull on AWS Fargate and S3
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-install-steps" class="md-nav__link">
    Pre-install steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-steps" class="md-nav__link">
    Installation Steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-master_application_config-env62yml" class="md-nav__link">
    Edit master_application_config-\&lt;env>.yml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-attributes-excluding-those-with-defaulted-values" class="md-nav__link">
    Required attributes (excluding those with defaulted values)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-attributes" class="md-nav__link">
    Optional attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-oracle-and-teradata-support" class="md-nav__link">
    (optional) Oracle and Teradata support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-datapull-infrastructure" class="md-nav__link">
    Create DataPull Infrastructure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-add-support-for-datapull-api-to-be-served-over-https" class="md-nav__link">
    (optional) Add support for DataPull API to be served over HTTPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-iam-user-and-roles-with-policies" class="md-nav__link">
    Create IAM User and Roles, with policies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-aws-fargate-api-app-and-other-aws-resources" class="md-nav__link">
    Create AWS Fargate API App and other AWS resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#browse-to-the-datapull-api-swagger-endpoint" class="md-nav__link">
    Browse to the DataPull API Swagger endpoint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-your-first-datapull" class="md-nav__link">
    Do your first DataPull
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aws_account_setup/" title="Setup VPC etc. in AWS Account for DataPull install" class="md-nav__link">
      Setup VPC etc. in AWS Account for DataPull install
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../oracle_teradata_support/" title="Add support for Oracle and Teradata" class="md-nav__link">
      Add support for Oracle and Teradata
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../emr_runbook/" title="Running DataPull on AWS EMR" class="md-nav__link">
      Running DataPull on AWS EMR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../transformation/" title="Sample input JSON" class="md-nav__link">
      Sample input JSON
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../monitor_spark_ui/" title="Monitor DataPull jobs using Spark UI" class="md-nav__link">
      Monitor DataPull jobs using Spark UI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-install-steps" class="md-nav__link">
    Pre-install steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-steps" class="md-nav__link">
    Installation Steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-master_application_config-env62yml" class="md-nav__link">
    Edit master_application_config-\&lt;env>.yml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-attributes-excluding-those-with-defaulted-values" class="md-nav__link">
    Required attributes (excluding those with defaulted values)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-attributes" class="md-nav__link">
    Optional attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-oracle-and-teradata-support" class="md-nav__link">
    (optional) Oracle and Teradata support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-datapull-infrastructure" class="md-nav__link">
    Create DataPull Infrastructure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-add-support-for-datapull-api-to-be-served-over-https" class="md-nav__link">
    (optional) Add support for DataPull API to be served over HTTPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-iam-user-and-roles-with-policies" class="md-nav__link">
    Create IAM User and Roles, with policies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-aws-fargate-api-app-and-other-aws-resources" class="md-nav__link">
    Create AWS Fargate API App and other AWS resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#browse-to-the-datapull-api-swagger-endpoint" class="md-nav__link">
    Browse to the DataPull API Swagger endpoint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-your-first-datapull" class="md-nav__link">
    Do your first DataPull
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/homeaway/datapull/edit/master/docs/docs/install_on_aws.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="deploying-datapull-on-aws-fargate-and-aws-emr">Deploying DataPull on AWS Fargate and AWS EMR</h1>
<p>This document helps you install DataPull on an Amazon AWS account, and run your first DataPull job of converting CSV data in AWS S3 to JSON data. </p>
<p>In a nutshell, deploying DataPull to an AWS Account
- creates three IAM Roles
    - <code>datapull_task_role</code>, <code>datapull_task_execution_role</code> for running the DataPull REST API on AWS Fargate
    - <code>emr_ec2_datapull_role</code> for running ephemeral AWS EMR clusters
- creates an IAM User <code>datapull_user</code> temporarily for the purpose of installing the following DataPull components
    - an AWS Fargate service <code>datapull-web-api</code> with an associated image in AWS ECR, and AWS Application Load Balancer (ALB)
    - an AWS CloudWatch Log Group <code>datapull_cloudwatch_log_group</code> and associated log stream
- stores DataPull JAR for EMR, job history, EMR logs in an existing AWS S3 bucket</p>
<blockquote>
<p>Note: <code>&lt;xyz&gt;</code> denotes a variable/attribute named <code>xyz</code> in the DataPull configuration file</p>
</blockquote>
<h2 id="pre-install-steps">Pre-install steps</h2>
<ul>
<li>Clone/download the master branch of this repo</li>
<li>Have available, the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">AWS Profile</a> <code>&lt;aws_admin_profile&gt;</code> of an IAM user/role that can create IAM users and IAM roles in your AWS account<ul>
<li>It is advisable this IAM user/role have admin access to the AWS account. Typically these credentials will be available only to the team managing the AWS account; hence the team deploying DataPull will need to coordinate with the team managing the AWS account. </li>
</ul>
</li>
<li>Have an S3 bucket <code>&lt;s3_bucket_name&gt;</code> (this bucket can be an existing bucket or a new bucket) that DataPull will use to store artifacts and logs under the folder <code>datapull-opensource</code>. The installation will use the name name as the prefix for new resources needed by DataPull, such as ECS service, Application load balancer, etc.</li>
<li>Have available a VPC with ID <code>&lt;vpc_id&gt;</code> in the AWS region <code>&lt;region&gt;</code></li>
<li>Have available, two AWS VPC subnet ids <code>&lt;application_subnet_1&gt;</code>,  <code>&lt;application_subnet_2&gt;</code> in the region VPC with ID <code>&lt;vpc_id&gt;</code> accessible to your clients. These subnets should ideally be private subnets, for the sake of security.</li>
<li>Have available a security group with ID <code>&lt;application_security_group&gt;</code> that either your bastion node is a part of (for SSH-forwarding ports to your client network), or your client network has access to TCP ports 443 (if you wish to serve DataPull API over HTTPS), 8080 (if you wish to serve DataPull API over HTTP), 8088 (to access Spark Application Manager for monitoring DataPull), 20888 (to access Spark UI on EMR master for monitoring DataPull)<ul>
<li>if you are using DataPull in a dedicated/new VPC created by following <a href="/aws_account_setup">these instructions</a>, please use the ID of the security group <code>ElasticMapReduce-Master-Private</code></li>
</ul>
</li>
<li>Have Docker installed on the machine used for deployment</li>
<li>If you wish to serve the DataPull API over HTTPS (say, at https://datapull.yourdomain.com), have available <ul>
<li>the ARN <code>&lt;load_balancer_certificate_arn&gt;</code> of an existing Certificate stored in AWS Certificate Manager that is valid for <code>datapull.yourdomain.com</code></li>
<li>the ability to create/modify a CNAME record for <code>datapull.yourdomain.com</code> to point to the load balancer URL for the DataPull API that will be created later in these instructions.</li>
</ul>
</li>
<li>Choose which environment <code>&lt;env&gt;</code> this DataPull deployment is for. Valid environments are <ul>
<li><code>dev</code></li>
<li><code>test</code></li>
<li><code>stage</code></li>
<li><code>prod</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>Pro-tip: Record the values of the variables in the pre-install steps, as a text file. Here is an example (with fake values)...
<code>&lt;aws_admin_profile&gt; : default
&lt;s3_bucket_name&gt; : datatools-datapull
&lt;vpc_id&gt; : vpc-071957e514a1fbd73
&lt;region&gt; : us-west-2
&lt;application_subnet_1&gt; : subnet-04903ae2649294308
&lt;application_subnet_2&gt; : subnet-0e10783af0de2513e
&lt;application_security_group&gt; : sg-08beb77f882d5d2a2
&lt;load_balancer_certificate_arn&gt; : arn:aws:acm:us-west-2:771905877783:certificate/2b1d3729-aa6d-47d5-8902-d0f9e75b35a8
&lt;env&gt; : stage</code></p>
</blockquote>
<h2 id="installation-steps">Installation Steps</h2>
<h3 id="edit-master_application_config-env62yml">Edit master_application_config-\&lt;env>.yml</h3>
<p>This file is present in the root directory of the repo.</p>
<h4 id="required-attributes-excluding-those-with-defaulted-values">Required attributes (excluding those with defaulted values)</h4>
<ul>
<li>datapull.application.region: Put <code>&lt;region&gt;</code> here</li>
<li>datapull.api.s3_bucket_name: Put <code>&lt;s3_bucket_name&gt;</code> here</li>
<li>datapull.api.application_subnet_1: Put <code>&lt;application_subnet_1&gt;</code> here</li>
<li>datapull.api.application_subnet_2: Put <code>&lt;application_subnet_2&gt;</code> here</li>
<li>datapull.api.application_security_group: Put <code>&lt;application_security_group&gt;</code> here</li>
<li>datapull.api.vpc_id: Put <code>&lt;vpc_id&gt;</code> here</li>
</ul>
<h4 id="optional-attributes">Optional attributes</h4>
<p>The following attributes need to be specified if you need DataPull to retrieve credentials from Hashicorp Vault to connect to your data stores. </p>
<blockquote>
<p>For this functionality to work, you need 
- DataPull to run on AWS EMR (this is the default behaviour), or on a Spark cluster whose node(s) run on AWS EC2.
- a Hashicorp Vault cluster whose API is accessible at <vault_url> (e.g. https://myvault.mydomain.com:8200)
- credentials for the database cluster <cluster> in the format <code>{ "username": "&lt;username&gt;", "password": "&lt;password&gt;" }</code> stored as a static secret at the location <code>&lt;vault_url&gt;/&lt;static_secret_path_prefix&gt;/&lt;cluster&gt;/&lt;username&gt;</code> . For example, if you need DataPull to retrieve the credentials for the user <code>mydbuser</code> of the MySql cluster <code>mycluster</code> from the Vault cluster static secret path https://myvaultcluster:8200/v1/secret/mycluster/mydbuser , you will need to store the credentials using the cUrl command <code>curl -X POST https://myvaultcluster:8200/v1/secret/mycluster/mydbuser -H 'X-Vault-Token: &lt;valid Vault token&gt;' -d '{ "username": "mydbuser", "password": "&lt;password&gt;" }'</code>
- <a href="https://www.vaultproject.io/docs/auth/aws.html#ec2-auth-method">AWS EC2 Auth method</a> set up on the Vault cluster, and the IAM Role of the Spark cluster mapped to a Vault policy that allows it to read the secret at the location <code>&lt;vault_url&gt;/&lt;static_secret_path_prefix&gt;/&lt;cluster&gt;/&lt;username&gt;</code></p>
</blockquote>
<ul>
<li>datapull.secretstore.vault.vault_url: Put <code>&lt;vault_url&gt;</code> here</li>
<li>datapull.secretstore.vault.vault_nonce: Put a <a href="https://www.vaultproject.io/docs/auth/aws.html#client-nonce">Client nonce</a> here</li>
<li>datapull.secretstore.vault.static_secret_path_prefix: Put <code>&lt;static_secret_path_prefix&gt;</code> here</li>
<li>datapull.secretstore.vault.vault_path_login: Put the path to the login url for the AWS EC2 Auth endpoint. e.g. <code>/v1/auth/&lt;AWS Auth endpoint name&gt;/login</code></li>
</ul>
<p>The following attribute needs to set if the DataPull API needs to be served over HTTPS.
- datapull.api.load_balancer_certificate_arn: Put <code>&lt;load_balancer_certificate_arn&gt;</code> here</p>
<p>The following attributes need to be set if you need DataPull to alert you if a job runs for too little time or if it runs too long. </p>
<blockquote>
<p>For this functionality, DataPull needs a SQL Server table <code>&lt;table&gt;</code> in the database <code>&lt;database&gt;</code> on the SQL Server instance <code>&lt;server&gt;</code>; and an SQL Server login <code>&lt;login&gt;</code> with password <code>&lt;password&gt;</code> that can write to this table. If this table does not exist, please create this table with the following schema
<code>CREATE TABLE [&lt;table&gt;](
   [JobId] [nvarchar](max) NULL,
   [Portfolio] [nvarchar](max) NULL,
   [Product] [nvarchar](max) NULL,
   [MasterNode] [nvarchar](max) NULL,
   [Ec2Role] [nvarchar](max) NULL,
   [elapsedtime] [float] NOT NULL,
   [minexecutiontime] [bigint] NOT NULL,
   [maxexecutiontime] [bigint] NOT NULL,
   [status] [nvarchar](max) NULL,
   [InstantNow] [nvarchar](max) NULL,
   [processedflag] [bigint] NOT NULL,
   [EmailAddress] [nvarchar](max) NULL,
   [pipelineName] [nvarchar](max) NULL,
   [awsenv] [nvarchar](max) NULL,
   [BccEmailAddress] [nvarchar](max) NULL
)</code>
- datapull.logger.mssql.server: Put <code>&lt;server&gt;</code> here
- datapull.logger.mssql.database: Put <code>&lt;database&gt;</code> here
- datapull.logger.mssql.login: Put <code>&lt;login&gt;</code> here
- datapull.logger.mssql.password: Put <code>&lt;password&gt;</code> here
- datapull.logger.mssql.table: Put <code>&lt;table&gt;</code> here</p>
</blockquote>
<p>The following attributes need to be set if you need DataPull to send an email report once each DataPull job completes, from the email address <code>&lt;emailaddress&gt;</code> through the SMTP server/relay <code>&lt;smtpserveraddress&gt;</code>
- datapull.logger.smtp.emailaddress: Put <code>&lt;emailaddress&gt;</code> here
- datapull.logger.smtp.smtpserveraddress: Put <code>&lt;smtpserveraddress&gt;</code> here</p>
<p>The following attributes need to be set if you need DataPull to send an email report once each DataPull job completes, from the email address <code>&lt;email&gt;</code>  using an existing SES instance that is accessiable using the AWS credentials <code>&lt;access_key&gt;</code>/<code>&lt;secret_key&gt;</code>
- datapull.logger.ses.email: Put <code>&lt;email&gt;</code> here
- datapull.logger.ses.access_key: Put <code>&lt;access_key&gt;</code> here
- datapull.logger.ses.secret_key: Put <code>&lt;secret_key&gt;</code> here</p>
<p>The following attributes need to be set if you wish to run the EMR clusters for DataPull in any other security groups than the default EMR security groups that are created by AWS automatically when an EMR cluster is created, ref https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-man-sec-groups.html
- datapull.emr.emr_security_group_master: Put <code>&lt;emr_security_group_master&gt;</code> here
- datapull.emr.emr_security_group_slave: Put <code>&lt;emr_security_group_slave&gt;</code> here
- datapull.emr.emr_security_group_service_access: Put <code>&lt;emr_security_group_service_access&gt;</code> here</p>
<h3 id="optional-oracle-and-teradata-support">(optional) Oracle and Teradata support</h3>
<p>Please follow the instructions on <a href="/oracle_teradata_support">this wiki</a> to use Oracle and/or Teradata as data sources/destinations for DataPull.</p>
<h3 id="create-datapull-infrastructure">Create DataPull Infrastructure</h3>
<h4 id="optional-add-support-for-datapull-api-to-be-served-over-https">(optional) Add support for DataPull API to be served over HTTPS</h4>
<ul>
<li>Edit the file <code>/api/terraform/datapull_task/datapull_ecs.tf</code><ul>
<li>Update the resource <code>aws_alb_listener</code> with <ul>
<li>protocol as <code>"HTTPS"</code> (instead of <code>"HTTP"</code>)</li>
<li>port as <code>443</code> (instead of <code>8080</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="create-iam-user-and-roles-with-policies">Create IAM User and Roles, with policies</h4>
<blockquote>
<p>It is recommended that this script be run by the team managing the AWS account from a terminal that has the AWS administrator credentials available as a profile <code>&lt;aws_admin_profile&gt;</code> in Credential Profile Chain, ref https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html i.e. you should have the AWS credentials set in 
   - either your <code>~/.aws/credentials</code> file if you're on a Mac
   - or in your environment variables, 
   - or you are running this script from an AWS instance with an IAM Role that has administrator privileges 
- From the terminal at the root of the repo, run 
    - <code>cd api/terraform/datapull_iam/</code>
    - <code>chmod +x create_user_and_roles.sh</code>
    -<code>./create_user_and_roles.sh &lt;aws_admin_profile&gt; &lt;s3_bucket_name&gt; &lt;region&gt;</code> . The script will create 
    - IAM Roles needed to run AWS Fargate and EMR
    - an IAM User <code>datapull_user</code> whose access key and secret key are created as a new AWS profile <code>datapull_user</code> using <a href="https://docs.aws.amazon.com/cli/latest/reference/configure/">aws configure CLI</a> 
        &gt; The IAM User <code>datapull_user</code> is used to install the remaining DataPull components like the AWS Fargate Cluster, the API load balancer, etc., so we recommend using <code>datapull_user</code> to set up a CI/CD pipeline for the next step. </p>
</blockquote>
<h4 id="create-aws-fargate-api-app-and-other-aws-resources">Create AWS Fargate API App and other AWS resources</h4>
<ul>
<li>Ensure that there exists an AWS Profile <code>datapull_user</code> corresponding to the IAM User <code>datapull_user</code> created by the previous step
    &gt; Pro-tip: You can verify this on a Mac by running the terminal command <code>cat ~/.aws/credentials</code></li>
<li>From the terminal (assuming you are using the same terminal session as the previous steps), run <ul>
<li><code>cd ../datapull_task/</code><ul>
<li>If you are at the root of the repo, run <code>cd api/terraform/datapull_task/</code></li>
</ul>
</li>
<li><code>chmod +x ecs_deploy.sh</code></li>
<li><code>./ecs_deploy.sh &lt;env&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="browse-to-the-datapull-api-swagger-endpoint">Browse to the DataPull API Swagger endpoint</h4>
<ul>
<li>On AWS Console, navigate to <code>Services &gt; EC2 &gt; Load Balancing &gt; Load Balancers</code>, and record the DNS name for DataPull's ALB (which is named <code>&lt;s3_bucket_name&gt;-api-alb</code>) as <code>&lt;datpull_alb_internal_name&gt;</code> (e.g. <code>internal-datatools-datapull-api-alb-507903794.us-west-2.elb.amazonaws.com</code>)</li>
<li>On your browser, open the API endpoint URL <code>http://&lt;datpull_alb_internal_name&gt;:8080/swagger-ui.html#!/data45pull45request45handler/startDataPullUsingPOST</code><ul>
<li>If you have selected private subnets for <code>&lt;application_subnet_1&gt;</code>,  <code>&lt;application_subnet_2&gt;</code>, or if these subnets are accessible only through a bastion host, please port-forward  <code>&lt;datpull_alb_internal_name&gt;:8080</code> using the terminal command <code>ssh -i "&lt;pem file for your ssh key&gt;" -N -L 8080:&lt;datpull_alb_internal_name&gt;:8080 &lt;bastion user&gt;@&lt;bastion host address&gt;</code> and then open the API endpoint URL <code>http://localhost:8080/swagger-ui.html#!/data45pull45request45handler/startDataPullUsingPOST</code><ul>
<li>if you are using a bastion host, please ensure that bastion host is a part of <code>&lt;application_security_group&gt;</code> (along with other security groups it might need for access from your client network)</li>
<li>if you are a EC2 instance in your public subnet as a poor man's bastion host as described in the <a href="/aws_account_setup">AWS Account Setup</a> wiki, then <code>&lt;bastion user&gt;</code> is <code>ec2-user</code> and <code>&lt;bastion host address&gt;</code> is the public IP of the EC2 instance</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="do-your-first-datapull">Do your first DataPull</h2>
<ul>
<li>Create a csv file at the S3 location <code>s3://&lt;s3_bucket_name&gt;/datapull-opensource/data/firstdatapull/source/helloworld.csv</code> with the following data</li>
</ul>
<pre><code>hellofield,worldfield
hello,world
</code></pre>

<ul>
<li>Post the following JSON input to the API endpoint url <code>http://&lt;datpull_alb_internal_name&gt;:8080/swagger-ui.html#!/data45pull45request45handler/startDataPullUsingPOST</code> .<ul>
<li>Please remember to replace <code>&lt;your_id@DOMAIN.com&gt;</code> and <code>&lt;s3_bucket_name&gt;</code> with valid data. </li>
</ul>
</li>
</ul>
<pre><code>{
    &quot;useremailaddress&quot;: &quot;&lt;your_id@DOMAIN.com&gt;&quot;,
    &quot;precisecounts&quot;: true,
    &quot;migrations&quot;: [
        {
            &quot;sources&quot;: [
                {
                    &quot;platform&quot;: &quot;s3&quot;,
                    &quot;s3path&quot;: &quot;&lt;s3_bucket_name&gt;/datapull-opensource/data/firstdatapull/source&quot;,
                    &quot;fileformat&quot;: &quot;csv&quot;,
                    &quot;savemode&quot;: &quot;Overwrite&quot;
                }
            ],
            &quot;destination&quot;: {
                &quot;platform&quot;: &quot;s3&quot;,
                &quot;s3path&quot;: &quot;&lt;s3_bucket_name&gt;/datapull-opensource/data/firstdatapull/destination&quot;,
                &quot;fileformat&quot;: &quot;json&quot;,
                &quot;savemode&quot;: &quot;Overwrite&quot;
            }
        }
    ],
    &quot;cluster&quot;: {
        &quot;pipelinename&quot;: &quot;firstdatapull&quot;,
        &quot;awsenv&quot;: &quot;dev&quot;,
        &quot;portfolio&quot;: &quot;Data Engineering Services&quot;,
        &quot;terminateclusterafterexecution&quot;: &quot;true&quot;,
        &quot;product&quot;: &quot;Data Engineering Data Tools&quot;,
        &quot;ComponentInfo&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;
    }
}
</code></pre>

<ul>
<li>In approximately 8 minutes (to account for the time taken for the ephemeral EMR cluster to spin up), you should get the data from the CSV converted into JSON and written to the S3 folder <code>s3://&lt;s3_bucket_name&gt;/datapull-opensource/data/firstdatapull/destination/</code></li>
<li>The logs for each DataPull invocation are available at <code>s3://&lt;s3_bucket_name&gt;/datapull-opensource/logs/DataPullHistory</code>. The logs for each migration with DataPull invocations are available at <code>s3://&lt;s3_bucket_name&gt;/datapull-opensource/logs/MigrationHistory</code></li>
<li>If you had configured the anonymous SMTP server for DataPull to send you email reports, you would get an email report with the subject <code>DataPull Report - firstdatapull (application_&lt;random_numbers&gt;)</code></li>
<li>While the ephemeral EMR cluster is in the <code>Running</code> status, you can monitor the progress of the Spark job by browing to the Spark UI at <code>http://&lt;ip of master node of EMR cluster&gt;:8088</code><ul>
<li>If you have selected a private subnet for <code>&lt;application_subnet_1&gt;</code> or if this subnet is accessible only through a bastion host, please port-forward  <code>&lt;ip of master node of EMR cluster&gt;:8088</code> and <code>&lt;ip of master node of EMR cluster&gt;:20888</code> using the terminal command <code>ssh -i "&lt;pem file for your ssh key&gt;" -N -L 8088:&lt;ip of master node of EMR cluster&gt;:8088 -L 20888:&lt;ip of master node of EMR cluster&gt;:20888 &lt;bastion user&gt;@&lt;bastion host address&gt;</code> and then open the API endpoint URL <code>http://localhost:8088</code></li>
</ul>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../architecture/" title="Architecture" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Architecture
              </span>
            </div>
          </a>
        
        
          <a href="../aws_account_setup/" title="Setup VPC etc. in AWS Account for DataPull install" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Setup VPC etc. in AWS Account for DataPull install
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a8b5e56f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>